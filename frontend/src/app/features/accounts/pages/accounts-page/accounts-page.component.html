<div class="accounts-page">
  <!-- Header -->
  <app-accounts-header
    [totalAccounts]="accounts().length"
    [connectedCount]="connectedCount()"
    [loading]="loading()"
    (onRefresh)="refresh()"
  />

  <!-- Totals -->
  <div class="totals-section">
    <div class="total-card eur">
      <div class="total-icon"><i class="fa fa-euro-sign"></i></div>
      <div class="total-info">
        <span class="total-label">Total EUR</span>
        <span class="total-value">{{ fmt.formatCurrency(totalEUR(), 'EUR') }}</span>
        <div class="total-details">
          <span [class]="fmt.getProfitClass(totalProfitEUR())">{{ fmt.formatCurrency(totalProfitEUR(), 'EUR') }}</span>
          <span [class]="fmt.getProfitClass(globalGrowthEUR())">({{ fmt.formatPercentSigned(globalGrowthEUR()) }})</span>
        </div>
      </div>
    </div>
    <div class="total-card usd">
      <div class="total-icon"><i class="fa fa-dollar-sign"></i></div>
      <div class="total-info">
        <span class="total-label">Total USD</span>
        <span class="total-value">{{ fmt.formatCurrency(totalUSD(), 'USD') }}</span>
        <div class="total-details">
          <span [class]="fmt.getProfitClass(totalProfitUSD())">{{ fmt.formatCurrency(totalProfitUSD(), 'USD') }}</span>
          <span [class]="fmt.getProfitClass(globalGrowthUSD())">({{ fmt.formatPercentSigned(globalGrowthUSD()) }})</span>
        </div>
      </div>
    </div>
    <div class="total-card stats">
      <div class="total-icon"><i class="fa fa-chart-pie"></i></div>
      <div class="total-info">
        <span class="total-label">Statistiques</span>
        <span class="total-value">{{ totalTrades() }} trades</span>
        <div class="total-details">
          <span class="winrate-badge"><i class="fa fa-trophy"></i> Win Rate: {{ globalWinRate().toFixed(1) }}%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Error -->
  @if (error()) {
    <div class="error-banner"><i class="fa fa-exclamation-triangle"></i> {{ error() }}</div>
  }

  <!-- Loading -->
  @if (loading() && accounts().length === 0) {
    <div class="loading-state"><i class="fa fa-spinner fa-spin"></i><p>Chargement...</p></div>
  }

  <!-- Grid View -->
  @if (viewMode() === 'grid') {
    <div class="accounts-grid">
      @for (account of filteredAccounts(); track account.id) {
        <div class="account-card" (click)="openAccount(account)" [class.disconnected]="!account.connected" [class]="fmt.getPerformanceClass(account.profit_percent)">
          <button class="favorite-btn" (click)="toggleFavorite(account.id, $event)" [class.active]="storage.isFavorite(account.id)">
            <i class="fa fa-star"></i>
          </button>
          <div class="card-header">
            <div class="account-avatar"><i class="fa fa-wallet"></i></div>
            <div class="account-info">
              <h3>{{ account.name }}</h3>
              <span class="account-id">#{{ account.id }}</span>
            </div>
            <div class="connection-status" [class.connected]="account.connected">
              <i class="fa fa-circle"></i>
              {{ account.connected ? 'Connecté' : 'Déconnecté' }}
            </div>
          </div>
          <div class="balance-badge">
            <span class="balance-value">{{ fmt.formatCurrency(account.balance, account.currency) }}</span>
            <div class="growth-small" [class]="fmt.getProfitClass(account.profit_percent)">
              <i class="fa" [class.fa-arrow-up]="account.profit_percent >= 0" [class.fa-arrow-down]="account.profit_percent < 0"></i>
              {{ fmt.formatPercentSigned(account.profit_percent) }}
            </div>
            @if (getSparklineData(account.id).length > 1) {
              <div class="sparkline-container">
                <app-sparkline [data]="getSparklineData(account.id)" [height]="80"></app-sparkline>
              </div>
            }
          </div>
          <div class="card-stats">
            <div class="stat-item"><span class="stat-label">Win Rate</span><span class="stat-value winrate">{{ account.win_rate.toFixed(1) }}%</span></div>
            <div class="stat-item"><span class="stat-label">Drawdown</span><span class="stat-value" [class]="fmt.getDrawdownClass(account.drawdown)">{{ account.drawdown.toFixed(2) }}%</span></div>
            <div class="stat-item"><span class="stat-label">Trades</span><span class="stat-value">{{ account.trades }}</span></div>
            <div class="stat-item"><span class="stat-label">Profit</span><span class="stat-value" [class]="fmt.getProfitClass(account.profit)">{{ fmt.formatCurrency(account.profit, account.currency) }}</span></div>
          </div>
          <div class="card-footer">
            <div class="footer-item"><i class="fa fa-building"></i> {{ account.broker }}</div>
            <div class="footer-item"><i class="fa fa-balance-scale"></i> 1:{{ account.leverage }}</div>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty -->
  @if (!loading() && filteredAccounts().length === 0 && !error()) {
    <div class="empty-state"><i class="fa fa-wallet"></i><p>Aucun compte trouvé</p></div>
  }
</div>
