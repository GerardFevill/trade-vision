<div class="portfolios-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title"><i class="fa fa-briefcase"></i> Portefeuilles</h1>
      <span class="portfolio-count">{{ filteredPortfolios().length }} portefeuilles</span>
    </div>
    <div class="header-right">
      <div class="client-filter">
        <button class="btn-filter" [class.active]="clientFilter() === 'all'" (click)="setClientFilter('all')">
          Tous
        </button>
        @for (client of clients(); track client) {
          <button class="btn-filter" [class.active]="clientFilter() === client" (click)="setClientFilter(client)">
            {{ client }}
          </button>
        }
      </div>
      <button class="btn-create" (click)="openCreateModal()">
        <i class="fa fa-plus"></i> Nouveau Portefeuille
      </button>
    </div>
  </header>

  <!-- Summary Row -->
  <div class="summary-row">
    <div class="summary-item trading">
      <i class="fa fa-chart-bar"></i>
      <span class="label">Trading</span>
      <span class="value">{{ fmt.formatCurrency(tradingBalance(), 'EUR') }}</span>
    </div>
    <div class="summary-item securise">
      <i class="fa fa-shield-alt"></i>
      <span class="label">Securise</span>
      <span class="value">{{ fmt.formatCurrency(securiseBalance(), 'EUR') }}</span>
    </div>
    <div class="view-toggle">
      <button class="btn-view" [class.active]="viewMode() === 'cards'" (click)="setViewMode('cards')">
        <i class="fa fa-th-large"></i>
      </button>
      <button class="btn-view" [class.active]="viewMode() === 'list'" (click)="setViewMode('list')">
        <i class="fa fa-list"></i>
      </button>
    </div>
  </div>

  <!-- Error -->
  @if (error()) {
    <div class="error-banner"><i class="fa fa-exclamation-triangle"></i> {{ error() }}</div>
  }

  <!-- Loading -->
  @if (loading() && portfolios().length === 0) {
    <div class="loading-state"><i class="fa fa-spinner fa-spin"></i><p>Chargement des portefeuilles...</p></div>
  }

  <!-- Portfolios Grid View -->
  @if (viewMode() === 'cards') {
    <div class="portfolios-grid">
      @for (portfolio of filteredPortfolios(); track portfolio.id) {
        <app-portfolio-card
          [portfolio]="portfolio"
          (click)="openPortfolio(portfolio)"
          (delete)="deletePortfolio(portfolio, $event)">
        </app-portfolio-card>
      }
    </div>
  }

  <!-- Portfolios List View -->
  @if (viewMode() === 'list') {
    <div class="portfolios-list">
      <table class="portfolio-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Type</th>
            <th>Client</th>
            <th class="col-number">Balance</th>
            <th class="col-number">Profit</th>
            <th class="col-number">Comptes</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @for (p of filteredPortfolios(); track p.id) {
            <tr (click)="openPortfolio(p)">
              <td class="col-name">{{ p.name }}</td>
              <td><span class="type-badge" [class]="getTypeClass(p.type)">{{ p.type }}</span></td>
              <td class="col-client">{{ p.client }}</td>
              <td class="col-number">{{ fmt.formatCurrency(p.total_balance, 'EUR') }}</td>
              <td class="col-number" [class]="fmt.getProfitClass(p.total_profit)">
                {{ fmt.formatCurrency(p.total_profit, 'EUR') }}
              </td>
              <td class="col-number">{{ p.account_count }}</td>
              <td class="col-actions">
                <button class="btn-delete" (click)="deletePortfolio(p, $event)">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Empty State -->
  @if (!loading() && filteredPortfolios().length === 0 && !error()) {
    <div class="empty-state">
      <i class="fa fa-briefcase"></i>
      <p>Aucun portefeuille</p>
      <button class="btn-create-empty" (click)="openCreateModal()">
        <i class="fa fa-plus"></i> Creer un portefeuille
      </button>
    </div>
  }

  <!-- Create Modal -->
  @if (showCreateModal()) {
    <div class="modal-backdrop" (click)="closeCreateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <app-portfolio-form
          (created)="onPortfolioCreated()"
          (cancelled)="closeCreateModal()">
        </app-portfolio-form>
      </div>
    </div>
  }
</div>
